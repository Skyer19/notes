scBERT 是一种用于处理单细胞 RNA 测序数据的模型。

- scBERT is pre-trained via an imputation task on 1.12 million human cells where "masked" gene expression values are predicted as a function of all other gene embeddings in a cell. 
- During fine-tuning, a 3-layer neural network is trained on smaller, labeled datasets to take the gene embeddings outputted by the transformer layers and predict cell type.

## scBERT 的嵌入机制

### 基因嵌入的组成
scBERT 中，每个基因的嵌入由两个部分组成：

1. **基因的归一化、分箱的对数表达水平嵌入**：这个嵌入表示基因在单细胞 RNA 测序中的表达水平。为了表示这些水平，模型对基因的表达数据进行了归一化，并采用了分箱技术，将表达值按照对数刻度进行划分。通过这种方式，可以得到一个表示基因表达水平的嵌入向量。
   
2. **基因身份嵌入**：这个嵌入通过[Gene2Vec方法](../../Project/相关方法和模型/Gene2Vec.md)来实现。Gene2Vec是一种将基因映射到向量空间的技术，使得每个基因都有一个独特的向量表示。这种方法能够有效地捕捉基因之间的关系和特征，使模型能够区分不同的基因。

### 嵌入的结合
通过将这两种嵌入相加，scBERT 能够为每个基因生成一个综合的嵌入向量，这个向量既包含基因的表达水平信息，也包含基因的身份信息。这种方法能够帮助模型在处理无序的数据时更好地理解和区分不同的基因。

**分箱技术 (Binning)**

分箱技术（Binning）是一种数据预处理方法，通常用于将连续变量转换为离散变量。这在机器学习和数据分析中非常有用，因为离散化后的数据可以简化模型处理，并且有助于捕捉数据的模式。具体到 scBERT 模型中的应用，分箱技术用于处理基因的表达水平数据。

#### 为什么使用分箱技术？

在单细胞 RNA 测序数据中，基因的表达水平通常是连续的数值数据。直接处理这些连续数据可能会带来以下问题：

1. **数值范围广泛**：基因表达水平可能跨越几个数量级，导致数据分布不均。
2. **数值敏感度**：模型对数值的微小变化可能过于敏感，导致过拟合或欠拟合。
3. **计算复杂度**：连续数据的复杂性可能增加计算量和模型训练的难度。

通过分箱技术，可以将这些连续数据转换为离散的“箱”（bin），每个箱代表一个数值范围，从而简化数据处理过程。

#### 分箱技术的具体步骤

1. **数据归一化**：首先，将基因表达水平数据进行归一化处理，以减小数据范围。例如，可以将表达水平映射到 0 到 1 之间。
2. **对数变换**：因为基因表达水平的数据通常呈现对数分布，可以对数据进行对数变换，以压缩数据的范围。这一步有助于处理具有大跨度的数值。
3. **分箱**：将对数变换后的数据按照一定的规则划分为多个箱。例如，可以将数据分成若干个等间距的区间，每个区间代表一个箱。每个基因的表达水平数据会被分配到对应的箱中，形成离散的数值。

#### 示例

假设我们有一些基因表达水平的数据，经过对数变换后得到以下数值：

```
[0.1, 0.5, 1.2, 3.5, 7.0]
```

我们希望将这些数据分成 3 个箱：

1. 箱 1: 0.0 到 1.0
2. 箱 2: 1.0 到 2.0
3. 箱 3: 2.0 以上

通过分箱技术，我们可以将上述数据转换为以下离散值：

```
[1, 1, 2, 3, 3]
```

每个数值被分配到对应的箱中，形成离散的数值表示。

#### 在 scBERT 中的应用

在 scBERT 模型中，基因的表达水平经过上述分箱处理后，每个基因的表达水平被映射到一个离散的嵌入向量。这些嵌入向量再与基因身份嵌入向量相加，形成最终的基因嵌入。这种方法有助于模型更好地理解和区分基因表达水平的数据，同时提高计算效率和模型效果。


## 处理过程

### Performer层
[点击详细](../../Project/相关方法和模型/Performer层.md)

scBERT使用了一种称为 Performer 的内存高效层来处理这些嵌入。Performer 是一种改进的注意力机制，旨在减少计算复杂度和内存消耗，同时保持 Transformer 模型的高效性和准确性。通过使用 Performer 层，scBERT 能够在处理大规模单细胞 RNA 数据时保持高效的计算性能和良好的模型效果。

## 总结
scBERT 模型的核心思想是通过将基因的表达水平嵌入和基因身份嵌入结合起来，生成一个综合的基因嵌入向量。然后，这些嵌入向量通过内存高效的 Performer 层进行处理，生成模型的输出。这种方法使得 scBERT 能够在处理无序的单细胞 RNA 测序数据时，准确地捕捉和区分基因之间的差异，从而提高数据分析的效果和效率。